---
layout:     post
title:      关于TCP处理红点问题踩坑记录
subtitle:   
date:       2022-11-15
author:     JohnWayne
header-img: resources/Gigaya.jpg
catalog: true
tags:
    - TCP
    - 游戏开发
---


# 需求背景
一个界面里有许多设施可以升级，需要消耗一定的道具。如果消耗道具满足要求，则显示红点。开发过程中发现，点击升级后，红点状态并没有刷新。
# 定位原因
原来，道具数量更新走的是TCP通知，而向后端发送升级请求后立马进入红点的逻辑判断，并不能保证是在TCP通知之后。最终导致刷新红点时，道具数量仍然没有改变。
# 解决方案
刷新逻辑不能在向后端请求解锁或升级的回包后，而应该在刷新该系统红点里加上物品变化的监听。

作者 [张巍]

2022 年 11月 15日    


